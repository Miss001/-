# 基本架构
![image](https://github.com/user-attachments/assets/94eeff51-56ea-4887-95b9-5fd9e0b9b2db)

## 逻辑结构
一个Postgresql服务器运行在一个主机(host)上并且管理着一个database cluster。  
一个DataBase Cluster可以包括：多个Database、多个User、以及Database中的所有对象。
一个Database 可以有多个Schema（数据库中的命名空间），在数据库中创建的所有对象都是在Schema中创建，一个用户可以从同一个客户端连接中访问不同的Schema。不同的Schema中可以有多个同名的表、视图、索引等对象。当创建一个数据库时，会为其创建一个名为public的默认Schema。  
每个Database是相互独立的，彼此之间无法直接进行跨库关联查询，需要借助dblink或其他扩展。  
每个Database都有自己独立的表和索引文件，表和索引文件的大小限制为1 GB。   
每个表都有两个关联文件、后缀分别为 _fsm 和 _vm。它们称为可用空间映射和可见性映射。用于存储有关可用空间容量的信息、并可查看表文件中的每个页面   
索引只具有单个可用空间映射、而不具有可见性映射。   
所有数据库对象都由各自的OID在内部管理，其OID存储在pg_database中。  
表和索引也由各个OID管理，其OID存储在pg_class中。 
```
-- 数据库对应的oid
select * from pg_database ;
-- 表/索引等对应的oid
select * from pg_class  
```
![image](https://github.com/user-attachments/assets/f4840d02-10db-419b-81cc-708b384e5aa6)


## 物理结构
一个database cluster基本上就是作为基础目录(base directory)的一个目录：$PGDATA  
一个database是base子目录下的一个子目录。  
每一个表和索引在base子目录中保存在(至少)一个文件（索引和数据可以保存在一个物理文件中）。  

## 数据类型
| 名称                                          | 别名                         | 描述                                   |
| --------------------------------------------- | ---------------------------- | -------------------------------------- |
| `smallint`                                    | `int2`                       | 有符号双字节整数                       |
| `integer`                                     | `int`，`int4`                | 有符号四字节整数                       |
| `bigint`                                      | `int8`                       | 有符号的八字节整数                     |
| `smallserial`                                 | `serial2`                    | 自动递增双字节整数                     |
| `bigserial`                                   | `serial8`                    | 自动递增八字节整数                     |
| `serial`                                      | `serial4`                    | 自动递增四字节整数                     |
| `real`                                        | `float4`                     | 单精度浮点数（4字节）                  |
| `double precision`                            | `float8`                     | 双精度浮点数（8 个字节）               |
| `numeric [ (*`p`*, *`s`*) ]`                  | `decimal [ (*`p`*, *`s`*) ]` | 可选精度的精确数字                     |
| `bit [ (*`n`*) ]`                             |                              | 固定长度的位串                         |
| `bit varying [ (*`n`*) ]`                     | `varbit [ (*`n`*) ]`         | 可变长度的位串                         |
| `boolean`                                     | `bool`                       | 逻辑布尔值（真/假）                    |
| `character [ (*`n`*) ]`                       | `char [ (*`n`*) ]`           | 定长字符串                             |
| `character varying [ (*`n`*) ]`               | `varchar [ (*`n`*) ]`        | 可变长度字符串                         |
| `text`                                        |                              | 可变长度字符串                         |
| `date`                                        |                              | 日历日期（年、月、日）                 |
| `time [ (*`p`*) ] [ without time zone ]`      |                              | 一天中的时间（无时区）                 |
| `time [ (*`p`*) ] with time zone`             | `timetz`                     | 一天中的时间，包括时区                 |
| `timestamp [ (*`p`*) ] [ without time zone ]` |                              | 日期和时间（无时区）                   |
| `timestamp [ (*`p`*) ] with time zone`        | `timestamptz`                | 日期和时间，包括时区                   |
| `interval [ *`fields`* ] [ (*`p`*) ]`         |                              | 时间跨度                               |
| `json`                                        |                              | 文本 JSON 数据                         |
| `jsonb`                                       |                              | 二进制 JSON 数据，已分解               |
| `uuid`                                        |                              | 通用唯一标识符                         |
| `bytea`                                       |                              | 二进制数据（“字节数组”）               |
| `xml`                                         |                              | XML 数据                               |
| `tsquery`                                     |                              | 文本搜索查询                           |
| `tsvector`                                    |                              | 文本搜索文档                           |
| `point`                                       |                              | 平面上的几何点                         |
| `polygon`                                     |                              | 平面上的封闭几何路径                   |
| `path`                                        |                              | 平面上的几何路径                       |
| `line`                                        |                              | 平面上的无限长线                       |
| `lseg`                                        |                              | 平面上的线段                           |
| `circle`                                      |                              | 平面上的圆                             |
| `box`                                         |                              | 平面上的矩形框                         |
| `inet`                                        |                              | IPv4 或 IPv6 主机地址                  |
| `macaddr`                                     |                              | MAC（媒体访问控制）地址                |
| `macaddr8`                                    |                              | MAC（媒体访问控制）地址（EUI-64 格式） |
| `cidr`                                        |                              | IPv4 或 IPv6 网络地址                  |
| `money`                                       |                              | 货币金额                               |
| `pg_lsn`                                      |                              | PostgreSQL日志序列号                   |
| `pg_snapshot`                                 |                              | 用户级交易ID快照                       |

## 常用函数
