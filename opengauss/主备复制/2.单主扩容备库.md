
# 单主扩容备库
主库：192.168.131.20   
备库：192.168.131.21

## 前提
备库与主库基础环境一致  
主从配置/etc/hosts文件

# 主节点
## 配置SSH互信
```
#主库
ssh-keygen -t rsa
cat .ssh/id_rsa.pub >> ~/.ssh/authorized_keys
#将公钥收集至known_hosts中分发至所有节点
ssh-keyscan -t rsa 192.168.131.20 >> ~/.ssh/known_hosts
```

## 主节点修改cluster_config.xml 文件
```
<?xml version="1.0" encoding="UTF-8"?>
<ROOT>
    <!-- openGauss整体信息 -->
    <CLUSTER>
        <!-- 数据库名称 -->
        <PARAM name="clusterName" value="dbCluster" />
        <!-- 数据库节点名称(hostname) -->
        <PARAM name="nodeNames" value="master,slaver" />
        <!-- 数据库安装目录-->
        <PARAM name="gaussdbAppPath" value="/opt/openGauss/install/app" />
        <!-- 日志目录-->
        <PARAM name="gaussdbLogPath" value="/opt/openGauss/log/omm" />
        <!-- 临时文件目录-->
        <PARAM name="tmpMppdbPath" value="/opt/openGauss/tmp" />
        <!-- 数据库工具目录-->
        <PARAM name="gaussdbToolPath" value="/opt/openGauss/install/om" />
        <!-- 数据库core文件目录-->
        <PARAM name="corePath" value="/opt/openGauss/corefile" />
        <!-- 节点IP，与数据库节点名称列表一一对应 -->
        <PARAM name="backIp1s" value="192.168.131.20,192.168.131.21"/>
    </CLUSTER>
    <!-- 每台服务器上的节点部署信息 -->
    <DEVICELIST>
        <!-- 主节点上的部署信息 -->
        <DEVICE sn="node1_master">
            <!-- 节点1的主机名称 -->
            <PARAM name="name" value="master"/>
            <!-- 节点1所在的AZ及AZ优先级 -->
            <PARAM name="azName" value="AZ1"/>
            <PARAM name="azPriority" value="1"/>
            <!-- 节点1的IP，如果服务器只有一个网卡可用，将backIP1和sshIP1配置成同一个IP -->
            <!-- 用ipv6安装部署时 换上ipv6地址即可，后面xml文件示例也是同样操作 -->
            <PARAM name="backIp1" value="192.168.131.20"/>
            <PARAM name="sshIp1" value="192.168.131.20"/>

            <!--dbnode-->
            <PARAM name="dataNum" value="1"/>
            <PARAM name="dataPortBase" value="15400"/>
            <PARAM name="dataNode1" value="/opt/openGauss/install/data/dn,slaver,/opt/openGauss/install/data/dn"/>
            <PARAM name="dataNode1_syncNum" value="0"/>

        </DEVICE>
        <!-- 从节点上的部署信息 -->
        <DEVICE sn="node1_slaver">
            <!-- 节点1的主机名称 -->
            <PARAM name="name" value="slaver"/>
            <!-- 节点1所在的AZ及AZ优先级 -->
            <PARAM name="azName" value="AZ1"/>
            <PARAM name="azPriority" value="1"/>
            <!-- 节点1的IP，如果服务器只有一个网卡可用，将backIP1和sshIP1配置成同一个IP -->
            <!-- 用ipv6安装部署时 换上ipv6地址即可，后面xml文件示例也是同样操作 -->
            <PARAM name="backIp1" value="192.168.131.21"/>
            <PARAM name="sshIp1" value="192.168.131.21"/>
            <PARAM name="cmServerPortStandby" value="25500"/>
            <PARAM name="cmDir" value="/opt/openGauss/install/data/cm"/>
        </DEVICE>
    </DEVICELIST>
</ROOT>
```
## 配置root环境变量
vi /etc/profile
```
export ORACLE_HOME=/usr/lib/oracle/21/client64
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=/opt/openGauss/install/app/lib:$LD_LIBRARY_PATH
export PERL5LIB=/root/perl5/lib/perl5
export PATH=$PATH:/root/perl5/bin/ora2pg
PATH=$PATH:$HOME/.local/bin:$HOME/bin
```
source /etc/profile

## 主节点扩容
```
cd /opt/openGauss/install/om/script
./gs_expansion -U omm -G dbgrp -X /opt/openGausssource/cluster_config.xml -h 192.168.131.21
```





